
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tutorial: Resolution of an inverse problem &#8212; PINA 0.1.2.post2411 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="/css/custom.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../../_static/documentation_options.js?v=b86f7f31"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_rst/tutorials/tutorial7/tutorial';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Tutorial: One dimensional Helmotz equation using Periodic Boundary Conditions" href="../tutorial9/tutorial.html" />
    <link rel="prev" title="Tutorial: Two dimensional Wave problem with hard constraint" href="../tutorial3/tutorial.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.1.2.post2411" />
    <meta name="docbuild:last-update" content="Nov 01, 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/PINA_logo.png" class="logo__image only-light" alt="PINA 0.1.2.post2411 documentation - Home"/>
    <img src="../../../_static/PINA_logo.png" class="logo__image only-dark pst-js-only" alt="PINA 0.1.2.post2411 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../_installation.html">
    Installing
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../_tutorial.html">
    Tutorial
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../_code.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../_team.html">
    Team & Foundings
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../_contributing.html">
    Contributing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../_LICENSE.html">
    License
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../_cite.html">
    Cite PINA
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/mathLab/PINA" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://x.com/pina_mathlab?s=21" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="mailto:pina.mathlab@gmail.com" title="Email" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Email</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../_installation.html">
    Installing
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../_tutorial.html">
    Tutorial
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../_code.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../_team.html">
    Team & Foundings
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../_contributing.html">
    Contributing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../_LICENSE.html">
    License
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../_cite.html">
    Cite PINA
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/mathLab/PINA" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://x.com/pina_mathlab?s=21" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="mailto:pina.mathlab@gmail.com" title="Email" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Email</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorial1/tutorial.html">Introduction to PINA for Physics Informed Neural Networks training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial12/tutorial.html">Introduction to PINA Equation class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial11/tutorial.html">PINA and PyTorch Lightning, training tips and visualizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial6/tutorial.html">Building custom geometries with PINA Location class</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorial2/tutorial.html">Two dimensional Poisson problem using Extra Features Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial3/tutorial.html">Two dimensional Wave problem with hard constraint</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Resolution of a 2D Poisson inverse problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial9/tutorial.html">Periodic Boundary Conditions for Helmotz Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial13/tutorial.html">Multiscale PDE learning with Fourier Feature Network</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorial5/tutorial.html">Two dimensional Darcy flow using the Fourier Neural Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial10/tutorial.html">Time dependent Kuramoto Sivashinsky equation using the Averaging Neural Operator</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorial4/tutorial.html">Unstructured convolutional autoencoder via continuous convolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial8/tutorial.html">POD-RBF and POD-NN for reduced order modeling</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../_tutorial.html" class="nav-link">PINA Tutorials</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Tutorial: Resolution of an inverse problem</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="tutorial-resolution-of-an-inverse-problem">
<h1>Tutorial: Resolution of an inverse problem<a class="headerlink" href="#tutorial-resolution-of-an-inverse-problem" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/mathLab/PINA/blob/master/tutorials/tutorial7/tutorial.ipynb"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<section id="introduction-to-the-inverse-problem">
<h2>Introduction to the inverse problem<a class="headerlink" href="#introduction-to-the-inverse-problem" title="Link to this heading">#</a></h2>
<p>This tutorial shows how to solve an inverse Poisson problem with
Physics-Informed Neural Networks. The problem definition is that of a
Poisson problem with homogeneous boundary conditions and it reads:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{equation}
\begin{cases}
\Delta u = e^{-2(x-\mu_1)^2-2(y-\mu_2)^2} \text{ in } \Omega\, ,\\
u = 0 \text{ on }\partial \Omega,\\
u(\mu_1, \mu_2) = \text{ data}
\end{cases}
\end{equation}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\Omega\)</span> is a square domain
<span class="math notranslate nohighlight">\([-2, 2] \times [-2, 2]\)</span>, and
<span class="math notranslate nohighlight">\(\partial \Omega=\Gamma_1 \cup \Gamma_2 \cup \Gamma_3 \cup \Gamma_4\)</span>
is the union of the boundaries of the domain.</p>
<p>This kind of problem, namely the “inverse problem”, has two main goals:</p>
<ul class="simple">
<li><p>find the solution <span class="math notranslate nohighlight">\(u\)</span> that satisfies the Poisson equation</p></li>
<li><p>find the unknown parameters (<span class="math notranslate nohighlight">\(\mu_1\)</span>, <span class="math notranslate nohighlight">\(\mu_2\)</span>) that better fit some given data (third equation in the system above).</p></li>
</ul>
<p>In order to achieve both the goals we will need to define an
<code class="docutils literal notranslate"><span class="pre">InverseProblem</span></code> in PINA. Let’s start with useful imports.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>## routine needed to run the notebook on Google Colab
try:
  import google.colab
  IN_COLAB = True
except:
  IN_COLAB = False
if IN_COLAB:
  !pip install &quot;pina-mathlab&quot;

import matplotlib.pyplot as plt
import torch
from pytorch_lightning.callbacks import Callback
from pina.problem import SpatialProblem, InverseProblem
from pina.operators import laplacian
from pina.model import FeedForward
from pina.equation import Equation, FixedValue
from pina import Condition, Trainer
from pina.solvers import PINN
from pina.geometry import CartesianDomain
</pre></div>
</div>
<p>Then, we import the pre-saved data, for (<span class="math notranslate nohighlight">\(\mu_1\)</span>,
<span class="math notranslate nohighlight">\(\mu_2\)</span>)=(<span class="math notranslate nohighlight">\(0.5\)</span>, <span class="math notranslate nohighlight">\(0.5\)</span>). These two values are the
optimal parameters that we want to find through the neural network
training. In particular, we import the <code class="docutils literal notranslate"><span class="pre">input_points</span></code>(the spatial
coordinates), and the <code class="docutils literal notranslate"><span class="pre">output_points</span></code> (the corresponding <span class="math notranslate nohighlight">\(u\)</span>
values evaluated at the <code class="docutils literal notranslate"><span class="pre">input_points</span></code>).</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>data_output = torch.load(&#39;data/pinn_solution_0.5_0.5&#39;).detach()
data_input = torch.load(&#39;data/pts_0.5_0.5&#39;)
</pre></div>
</div>
<p>Moreover, let’s plot also the data points and the reference solution:
this is the expected output of the neural network.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>points = data_input.extract([&#39;x&#39;, &#39;y&#39;]).detach().numpy()
truth = data_output.detach().numpy()

plt.scatter(points[:, 0], points[:, 1], c=truth, s=8)
plt.axis(&#39;equal&#39;)
plt.colorbar()
plt.show()
</pre></div>
</div>
<img alt="../../../_images/output_8_0.png" src="../../../_images/output_8_0.png" />
</section>
<section id="inverse-problem-definition-in-pina">
<h2>Inverse problem definition in PINA<a class="headerlink" href="#inverse-problem-definition-in-pina" title="Link to this heading">#</a></h2>
<p>Then, we initialize the Poisson problem, that is inherited from the
<code class="docutils literal notranslate"><span class="pre">SpatialProblem</span></code> and from the <code class="docutils literal notranslate"><span class="pre">InverseProblem</span></code> classes. We here have
to define all the variables, and the domain where our unknown parameters
(<span class="math notranslate nohighlight">\(\mu_1\)</span>, <span class="math notranslate nohighlight">\(\mu_2\)</span>) belong. Notice that the laplace equation
takes as inputs also the unknown variables, that will be treated as
parameters that the neural network optimizes during the training
process.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>### Define ranges of variables
x_min = -2
x_max = 2
y_min = -2
y_max = 2

class Poisson(SpatialProblem, InverseProblem):
    &#39;&#39;&#39;
    Problem definition for the Poisson equation.
    &#39;&#39;&#39;
    output_variables = [&#39;u&#39;]
    spatial_domain = CartesianDomain({&#39;x&#39;: [x_min, x_max], &#39;y&#39;: [y_min, y_max]})
    # define the ranges for the parameters
    unknown_parameter_domain = CartesianDomain({&#39;mu1&#39;: [-1, 1], &#39;mu2&#39;: [-1, 1]})

    def laplace_equation(input_, output_, params_):
        &#39;&#39;&#39;
        Laplace equation with a force term.
        &#39;&#39;&#39;
        force_term = torch.exp(
                - 2*(input_.extract([&#39;x&#39;]) - params_[&#39;mu1&#39;])**2
                - 2*(input_.extract([&#39;y&#39;]) - params_[&#39;mu2&#39;])**2)
        delta_u = laplacian(output_, input_, components=[&#39;u&#39;], d=[&#39;x&#39;, &#39;y&#39;])

        return delta_u - force_term

    # define the conditions for the loss (boundary conditions, equation, data)
    conditions = {
        &#39;gamma1&#39;: Condition(location=CartesianDomain({&#39;x&#39;: [x_min, x_max],
            &#39;y&#39;:  y_max}),
            equation=FixedValue(0.0, components=[&#39;u&#39;])),
        &#39;gamma2&#39;: Condition(location=CartesianDomain({&#39;x&#39;: [x_min, x_max], &#39;y&#39;: y_min
            }),
            equation=FixedValue(0.0, components=[&#39;u&#39;])),
        &#39;gamma3&#39;: Condition(location=CartesianDomain({&#39;x&#39;:  x_max, &#39;y&#39;: [y_min, y_max]
            }),
            equation=FixedValue(0.0, components=[&#39;u&#39;])),
        &#39;gamma4&#39;: Condition(location=CartesianDomain({&#39;x&#39;: x_min, &#39;y&#39;: [y_min, y_max]
            }),
            equation=FixedValue(0.0, components=[&#39;u&#39;])),
        &#39;D&#39;: Condition(location=CartesianDomain({&#39;x&#39;: [x_min, x_max], &#39;y&#39;: [y_min, y_max]
            }),
        equation=Equation(laplace_equation)),
        &#39;data&#39;: Condition(input_points=data_input.extract([&#39;x&#39;, &#39;y&#39;]), output_points=data_output)
    }

problem = Poisson()
</pre></div>
</div>
<p>Then, we define the model of the neural network we want to use. Here we
used a model which impose hard constrains on the boundary conditions, as
also done in the Wave tutorial!</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model = FeedForward(
    layers=[20, 20, 20],
    func=torch.nn.Softplus,
    output_dimensions=len(problem.output_variables),
    input_dimensions=len(problem.input_variables)
    )
</pre></div>
</div>
<p>After that, we discretize the spatial domain.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>problem.discretise_domain(20, &#39;grid&#39;, locations=[&#39;D&#39;], variables=[&#39;x&#39;, &#39;y&#39;])
problem.discretise_domain(1000, &#39;random&#39;, locations=[&#39;gamma1&#39;, &#39;gamma2&#39;,
    &#39;gamma3&#39;, &#39;gamma4&#39;], variables=[&#39;x&#39;, &#39;y&#39;])
</pre></div>
</div>
<p>Here, we define a simple callback for the trainer. We use this callback
to save the parameters predicted by the neural network during the
training. The parameters are saved every 100 epochs as <code class="docutils literal notranslate"><span class="pre">torch</span></code> tensors
in a specified directory (<code class="docutils literal notranslate"><span class="pre">tmp_dir</span></code> in our case). The goal is to read
the saved parameters after training and plot their trend across the
epochs.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># temporary directory for saving logs of training
tmp_dir = &quot;tmp_poisson_inverse&quot;

class SaveParameters(Callback):
    &#39;&#39;&#39;
    Callback to save the parameters of the model every 100 epochs.
    &#39;&#39;&#39;
    def on_train_epoch_end(self, trainer, __):
        if trainer.current_epoch % 100 == 99:
            torch.save(trainer.solver.problem.unknown_parameters, &#39;{}/parameters_epoch{}&#39;.format(tmp_dir, trainer.current_epoch))
</pre></div>
</div>
<p>Then, we define the <code class="docutils literal notranslate"><span class="pre">PINN</span></code> object and train the solver using the
<code class="docutils literal notranslate"><span class="pre">Trainer</span></code>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>### train the problem with PINN
max_epochs = 5000
pinn = PINN(problem, model, optimizer_kwargs={&#39;lr&#39;:0.005})
# define the trainer for the solver
trainer = Trainer(solver=pinn, accelerator=&#39;cpu&#39;, max_epochs=max_epochs,
        default_root_dir=tmp_dir, callbacks=[SaveParameters()])
trainer.train()
</pre></div>
</div>
<p>One can now see how the parameters vary during the training by reading
the saved solution and plotting them. The plot shows that the parameters
stabilize to their true value before reaching the epoch <span class="math notranslate nohighlight">\(1000\)</span>!</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>epochs_saved = range(99, max_epochs, 100)
parameters = torch.empty((int(max_epochs/100), 2))
for i, epoch in enumerate(epochs_saved):
    params_torch = torch.load(&#39;{}/parameters_epoch{}&#39;.format(tmp_dir, epoch))
    for e, var in enumerate(pinn.problem.unknown_variables):
        parameters[i, e] = params_torch[var].data

# Plot parameters
plt.close()
plt.plot(epochs_saved, parameters[:, 0], label=&#39;mu1&#39;, marker=&#39;o&#39;)
plt.plot(epochs_saved, parameters[:, 1], label=&#39;mu2&#39;, marker=&#39;s&#39;)
plt.ylim(-1, 1)
plt.grid()
plt.legend()
plt.xlabel(&#39;Epoch&#39;)
plt.ylabel(&#39;Parameter value&#39;)
plt.show()
</pre></div>
</div>
<img alt="../../../_images/output_21_0.png" src="../../../_images/output_21_0.png" />
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-the-inverse-problem">Introduction to the inverse problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inverse-problem-definition-in-pina">Inverse problem definition in PINA</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../../_sources/_rst/tutorials/tutorial7/tutorial.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2021-2024, PINA Contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>